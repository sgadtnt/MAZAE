<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø© - Ø³Ø¬Ø§Ø¯ (Ù…Ø¯ÙŠØ±)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Tajawal', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1a2a6c, #2c3e50);
      min-height: 100vh;
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .admin-badge {
      background: linear-gradient(135deg, #4A00E0, #8E2DE2);
      color: white;
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 0.7rem;
      display: inline-block;
      margin-right: 5px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .admin-panel {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .chat-bubble {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .user-bubble {
      animation: slideInRight 0.3s ease-in-out;
    }
    
    .typing-indicator span {
      animation: bounce 1.5s infinite ease-in-out;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .emoji-btn {
      transition: all 0.2s ease;
    }
    
    .emoji-btn:hover {
      transform: scale(1.1);
    }
    
    .user-card {
      animation: slideInLeft 0.3s ease-in-out;
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .emoji-panel {
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .image-preview {
      max-width: 300px;
      border-radius: 10px;
      margin-top: 5px;
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .image-preview:hover {
      transform: scale(1.03);
    }
    
    .admin-controls {
      display: none;
    }
    
    .admin .admin-controls {
      display: block;
    }
    
    .guest-badge {
      background: linear-gradient(135deg, #00b09b, #96c93d);
      color: white;
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 0.7rem;
      display: inline-block;
      margin-right: 5px;
    }
    
    .file-upload-btn {
      position: relative;
      overflow: hidden;
      display: inline-block;
      cursor: pointer;
    }
    
    .file-upload-btn input[type="file"] {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 100%;
      min-height: 100%;
      font-size: 100px;
      text-align: right;
      filter: alpha(opacity=0);
      opacity: 0;
      outline: none;
      cursor: pointer;
      display: block;
    }
    
    .media-sent {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid rgba(76, 175, 80, 0.3);
      border-radius: 10px;
      padding: 8px;
      margin-top: 5px;
    }
    
    .header-gradient {
      background: linear-gradient(135deg, #1a2a6c, #2c3e50);
    }
    
    .quick-login-btn {
      background: linear-gradient(135deg, #00b09b, #96c93d);
      transition: all 0.3s ease;
    }
    
    .quick-login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .user-presence {
      display: flex;
      align-items: center;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 5px;
      background: rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .user-presence:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(-5px);
    }
    
    .presence-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 10px;
    }
    
    .presence-online {
      background: #00C853;
      box-shadow: 0 0 8px rgba(0, 200, 83, 0.5);
    }
    
    .presence-idle {
      background: #FFD600;
      box-shadow: 0 0 8px rgba(255, 214, 0, 0.5);
    }
    
    .presence-offline {
      background: #B0BEC5;
    }
    
    .message-time {
      font-size: 0.75rem;
      color: #78909C;
    }
    
    .chat-container {
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .message-input {
      transition: all 0.3s ease;
    }
    
    .message-input:focus {
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
    }
    
    .send-btn {
      transition: all 0.3s ease;
    }
    
    .send-btn:hover {
      transform: rotate(-5deg) scale(1.1);
    }
    
    .quick-message-btn {
      transition: all 0.2s ease;
      background: rgba(236, 239, 241, 0.7);
    }
    
    .quick-message-btn:hover {
      background: rgba(207, 216, 220, 0.9);
      transform: translateY(-2px);
    }
  </style>
</head>
<body class="py-8">
  <div class="max-w-6xl mx-auto px-4">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø£Ø³ -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 p-4 rounded-xl header-gradient">
      <div class="flex items-center mb-4 md:mb-0">
        <div class="bg-white p-2 rounded-full mr-3">
          <i class="fas fa-comments text-indigo-700 text-xl"></i>
        </div>
        <div>
          <h1 class="text-2xl md:text-3xl font-bold text-white flex items-center">
            ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            <span id="adminBadge" class="admin-badge hidden">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            <span id="guestBadge" class="guest-badge hidden">Ø¶ÙŠÙ</span>
          </h1>
          <div class="flex items-center mt-1">
            <div id="presenceCount" class="text-gray-200 flex items-center">
              <i class="fas fa-users mr-1"></i>
              <span>Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†: <span id="usersCount">0</span></span>
            </div>
            <div class="mx-3 text-gray-400">|</div>
            <div id="currentDateTime" class="text-gray-200"></div>
          </div>
        </div>
      </div>
      <button onclick="goBack()" class="bg-white hover:bg-gray-200 text-indigo-800 px-4 py-2 rounded-lg flex items-center font-bold shadow-lg transition-all hover:scale-105">
        <i class="fas fa-arrow-left mr-2"></i> Ø±Ø¬ÙˆØ¹
      </button>
    </div>
    
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† -->
      <div class="w-full lg:w-1/4 bg-white bg-opacity-90 rounded-2xl shadow-lg p-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-gray-800 flex items-center">
            <i class="fas fa-user-clock mr-2 text-indigo-600"></i> Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†
          </h2>
          <button onclick="refreshPresence()" class="text-sm bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-3 py-1 rounded flex items-center transition-all">
            <i class="fas fa-sync-alt mr-1"></i> ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div id="onlineUsers" class="space-y-2 max-h-96 overflow-y-auto">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¦Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
          <div class="text-center text-gray-500 py-4">
            <i class="fas fa-user-slash text-2xl mb-2"></i>
            <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ØªØµÙ„ÙŠÙ†</p>
          </div>
        </div>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø¯ÙŠØ±) -->
        <div id="adminPanel" class="admin-panel mt-6 rounded-xl p-4 hidden">
          <h3 class="text-lg font-bold text-white mb-3">
            <i class="fas fa-tools mr-2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
          </h3>
          <div class="space-y-3">
            <button onclick="deleteAllMessages()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg flex items-center justify-center transition-all">
              <i class="fas fa-trash mr-2"></i> Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            </button>
            <button onclick="sendSystemMessage()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg flex items-center justify-center transition-all">
              <i class="fas fa-bullhorn mr-2"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù…
            </button>
          </div>
        </div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div class="w-full lg:w-3/4">
        <div class="chat-container bg-white bg-opacity-90 rounded-2xl shadow-lg overflow-hidden">
          <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
          <div id="chatBox" class="h-96 overflow-y-auto p-4 bg-gray-50">
            <div class="text-center text-gray-500 py-8">
              <i class="fas fa-comment-dots text-4xl mb-2 text-indigo-400"></i>
              <p>Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
              <p class="text-sm mt-2 text-gray-400">Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ£Ø±Ø³Ù„ ØªØ­ÙŠØ© Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
            </div>
          </div>
          
          <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
          <div id="typingIndicator" class="bg-gray-100 px-4 py-2 hidden">
            <div class="flex items-center text-gray-600">
              <div class="typing-indicator mr-2">
                <span>.</span>
                <span>.</span>
                <span>.</span>
              </div>
              <span id="typingUsers"></span> ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†
            </div>
          </div>
          
          <!-- Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
          <div class="p-4 border-t border-gray-200">
            <div class="flex gap-2">
              <div class="relative flex-1">
                <div class="flex items-center border border-gray-300 rounded-lg bg-white message-input">
                  <!-- Ø²Ø± Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· -->
                  <div class="file-upload-btn cursor-pointer px-3 py-2 text-gray-500 hover:text-indigo-600">
                    <i class="fas fa-paperclip text-xl"></i>
                    <input type="file" id="mediaUpload" accept="image/*" class="file-input">
                  </div>
                  
                  <input 
                    id="messageInput" 
                    type="text" 
                    placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." 
                    class="flex-1 p-2 focus:outline-none"
                    onkeydown="handleKeyDown(event)"
                  />
                  
                  <button onclick="sendMessage()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 send-btn">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
                
                <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© -->
                <div id="imagePreviewContainer" class="mt-2 hidden">
                  <div class="flex items-center justify-between bg-gray-100 p-2 rounded-lg">
                    <span class="text-sm text-gray-600"><i class="fas fa-image mr-1"></i> ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©</span>
                    <button onclick="cancelImageUpload()" class="text-red-500 hover:text-red-700">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                  <img id="imagePreview" class="image-preview" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">
                </div>
              </div>
            </div>
            
            <div class="mt-3 flex flex-wrap gap-2">
              <button onclick="sendQuickMessage('Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ')" class="text-xs quick-message-btn text-gray-700 px-2 py-1 rounded">
                Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ
              </button>
              <button onclick="sendQuickMessage('Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙŠØŸ')" class="text-xs quick-message-btn text-gray-700 px-2 py-1 rounded">
                Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙŠØŸ
              </button>
              <button onclick="sendQuickMessage('Ø£Ø±Ø³Ù„Øª Ù„Ùƒ ØµÙˆØ±Ø© ğŸ‘‡')" class="text-xs quick-message-btn text-gray-700 px-2 py-1 rounded">
                Ø£Ø±Ø³Ù„Øª Ù„Ùƒ ØµÙˆØ±Ø© ğŸ‘‡
              </button>
              <button onclick="sendQuickMessage('Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©')" class="text-xs quick-message-btn text-gray-700 px-2 py-1 rounded">
                Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… -->
    <div id="nameModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
      <div class="bg-gradient-to-br from-indigo-900 to-purple-800 p-6 md:p-8 rounded-2xl w-full max-w-md text-center shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 to-red-500"></div>
        <div class="relative z-10">
          <div class="bg-white text-indigo-800 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center">
            <i class="fas fa-comments text-3xl"></i>
          </div>
          <h2 class="text-2xl font-bold text-white mb-2">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h2>
          <p class="text-gray-300 mb-6">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
          
          <div class="bg-white rounded-xl p-5 mb-4">
            <div class="mb-4">
              <div class="flex justify-between items-center mb-1">
                <label for="usernameInput" class="block text-gray-700 text-sm text-right">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <button onclick="clearUsername()" class="text-xs text-red-500 hover:text-red-700">
                  <i class="fas fa-trash mr-1"></i> Ø­Ø°Ù
                </button>
              </div>
              <div class="relative">
                <input 
                  id="usernameInput" 
                  type="text" 
                  placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
                  class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                  autofocus
                />
                <button onclick="generateRandomUsername()" class="absolute left-3 top-3 text-gray-500 hover:text-indigo-600">
                  <i class="fas fa-random"></i>
                </button>
              </div>
            </div>
            
            <div id="passwordSection" class="mb-4">
              <div class="flex justify-between items-center mb-1">
                <label for="passwordInput" class="block text-gray-700 text-sm text-right">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <button onclick="clearPassword()" class="text-xs text-red-500 hover:text-red-700">
                  <i class="fas fa-trash mr-1"></i> Ø­Ø°Ù
                </button>
              </div>
              <div class="relative">
                <input 
                  id="passwordInput" 
                  type="password" 
                  placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" 
                  class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                />
                <button onclick="generateRandomPassword()" class="absolute left-3 top-3 text-gray-500 hover:text-indigo-600">
                  <i class="fas fa-random"></i>
                </button>
              </div>
            </div>
            
            <div id="adminMessage" class="text-sm text-gray-600 mb-3 hidden">
              <i class="fas fa-info-circle mr-1"></i> Ø£Ù†Øª ØªØ­Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¥Ø¯Ø§Ø±ÙŠ
            </div>
          </div>
          
          <button onclick="checkLogin()" class="bg-gradient-to-r from-yellow-400 to-yellow-600 text-gray-900 px-6 py-3 rounded-lg w-full text-lg font-bold transition-all hover:from-yellow-500 hover:to-yellow-700">
            Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            <i class="fas fa-sign-in-alt ml-2"></i>
          </button>
          
          <button onclick="quickLogin()" class="quick-login-btn text-white px-6 py-3 rounded-lg w-full mt-4 font-bold">
            <i class="fas fa-bolt mr-2"></i> Ø¯Ø®ÙˆÙ„ Ø³Ø±ÙŠØ¹
          </button>
          
          <div class="mt-4 text-sm text-gray-300">
            <i class="fas fa-shield-alt mr-1"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙØ±Ø© ÙˆÙ…Ø­Ù…ÙŠØ©
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage
    const chatDB = {
      messages: [],
      users: [],
      media: [],
      
      init() {
        if (!localStorage.getItem('chatMessages')) {
          localStorage.setItem('chatMessages', JSON.stringify([]));
        }
        this.messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
        
        if (!localStorage.getItem('chatUsers')) {
          localStorage.setItem('chatUsers', JSON.stringify([]));
        }
        this.users = JSON.parse(localStorage.getItem('chatUsers')) || [];
        
        if (!localStorage.getItem('chatMedia')) {
          localStorage.setItem('chatMedia', JSON.stringify([]));
        }
        this.media = JSON.parse(localStorage.getItem('chatMedia')) || [];
      },
      
      addMessage(message) {
        message.id = Date.now().toString(); // Ø¥Ø¶Ø§ÙØ© id ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©
        this.messages.push(message);
        localStorage.setItem('chatMessages', JSON.stringify(this.messages));
      },
      
      addUser(user) {
        this.users.push(user);
        localStorage.setItem('chatUsers', JSON.stringify(this.users));
      },
      
      removeUser(userId) {
        this.users = this.users.filter(u => u.id !== userId);
        localStorage.setItem('chatUsers', JSON.stringify(this.users));
      },
      
      clearMessages() {
        this.messages = [];
        localStorage.setItem('chatMessages', JSON.stringify([]));
      },
      
      getMessages() {
        return this.messages;
      },
      
      getUsers() {
        return this.users;
      },
      
      addMedia(media) {
        media.id = Date.now().toString();
        this.media.push(media);
        localStorage.setItem('chatMedia', JSON.stringify(this.media));
      },
      
      getMedia() {
        return this.media;
      },
      
      deleteMessage(messageId) {
        this.messages = this.messages.filter(m => m.id !== messageId);
        localStorage.setItem('chatMessages', JSON.stringify(this.messages));
      },
      
      updateUser(userId) {
        const userIndex = this.users.findIndex(u => u.id === userId);
        if (userIndex !== -1) {
          this.users[userIndex].lastSeen = Date.now();
          localStorage.setItem('chatUsers', JSON.stringify(this.users));
        }
      }
    };

    // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    chatDB.init();

    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let username = "";
    let isAdmin = false;
    let isGuest = false;
    const chatBox = document.getElementById("chatBox");
    const usersCountEl = document.getElementById("usersCount");
    const onlineUsersEl = document.getElementById("onlineUsers");
    const typingIndicatorEl = document.getElementById("typingIndicator");
    const typingUsersEl = document.getElementById("typingUsers");
    const adminPanel = document.getElementById("adminPanel");
    const adminBadge = document.getElementById("adminBadge");
    const guestBadge = document.getElementById("guestBadge");
    const adminMessage = document.getElementById("adminMessage");
    const mediaUpload = document.getElementById("mediaUpload");
    const currentDateTime = document.getElementById("currentDateTime");
    let userId = Date.now().toString();
    let uploadedImage = null;
    let presenceInterval;

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª (Ø³Ø§Ø¹Ø©:Ø¯Ù‚ÙŠÙ‚Ø©)
    function formatTime(date) {
      const hours = date.getHours();
      const minutes = date.getMinutes().toString().padStart(2, "0");
      return hours + ':' + minutes;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    function updateDateTime() {
      const now = new Date();
      const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
      const day = days[now.getDay()];
      currentDateTime.textContent = `${day} - ${formatTime(now)}`;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function checkLogin() {
      const nameInput = document.getElementById("usernameInput").value.trim();
      const passwordInput = document.getElementById("passwordInput").value;
      
      if (!nameInput) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ "Ø³Ø¬Ø§Ø¯" Ù†Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ØµØ­ÙŠØ­Ø©
      if (nameInput === "Ø³Ø¬Ø§Ø¯") {
        if (passwordInput !== "Ø³Ø¬Ø§Ø¯") {
          alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
          return;
        }
        isAdmin = true;
        adminPanel.classList.remove("hidden");
        adminBadge.classList.remove("hidden");
        document.body.classList.add("admin");
      } else {
        // Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
        isGuest = true;
        guestBadge.classList.remove("hidden");
      }
      
      username = nameInput;
      document.getElementById("nameModal").style.display = "none";
      listenToMessages();
      setupPresence();
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
      setTimeout(() => {
        chatDB.addMessage({
          name: "Ø§Ù„Ù†Ø¸Ø§Ù…",
          text: `Ø§Ù†Ø¶Ù… ${username} ${isAdmin ? "(Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…)" : "(Ø¶ÙŠÙ)"} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©`,
          time: formatTime(new Date()),
          isSystem: true
        });
        updateChatUI();
      }, 1000);
    }

    // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
    function quickLogin() {
      generateRandomUsername();
      generateRandomPassword();
      setTimeout(checkLogin, 300);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    function generateRandomUsername() {
      const adjectives = ["Ø³Ø±ÙŠØ¹", "Ù‡Ø§Ø¯Ø¦", "Ù…Ø¨ØªÙƒØ±", "Ø®Ù„Ø§Ù‚", "Ø°ÙƒÙŠ", "Ù…Ø±Ø­", "Ù„Ø·ÙŠÙ", "ØµØ§Ø¯Ù‚", "Ø´Ø¬Ø§Ø¹"];
      const nouns = ["Ø£Ø³Ø¯", "Ù†Ø³Ø±", "Ø¨Ø­Ø±", "Ø¬Ø¨Ù„", "Ù†Ø¬Ù…", "Ù‚Ù…Ø±", "Ø´Ù…Ø³", "Ø³Ø­Ø§Ø¨", "ÙˆØ±Ø¯Ø©"];
      const randomAdj = adjectives[Math.floor(Math.random() * adjectives.length)];
      const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
      const randomNum = Math.floor(1000 + Math.random() * 9000);
      const randomUsername = `${randomAdj}_${randomNoun}_${randomNum}`;
      document.getElementById("usernameInput").value = randomUsername;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    function generateRandomPassword() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let password = "";
      for (let i = 0; i < 8; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      document.getElementById("passwordInput").value = password;
    }

    // Ø­Ø°Ù Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function clearUsername() {
      document.getElementById("usernameInput").value = "";
    }

    // Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    function clearPassword() {
      document.getElementById("passwordInput").value = "";
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    function sendMessage() {
      const msgInput = document.getElementById("messageInput");
      const msg = msgInput.value.trim();
      
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø±Ø³Ø§Ù„Ø© ÙˆÙ„Ø§ ØµÙˆØ±Ø©
      if (!msg && !uploadedImage) return;
      
      const messageData = {
        name: username,
        text: msg,
        time: formatTime(new Date()),
        userId: userId,
        isAdmin: isAdmin,
        isGuest: isGuest
      };
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©
      if (uploadedImage) {
        messageData.image = uploadedImage;
        // Ø­ÙØ¸ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        chatDB.addMedia({
          sender: username,
          type: 'image',
          url: uploadedImage,
          time: formatTime(new Date())
        });
      }
      
      chatDB.addMessage(messageData);
      updateChatUI();
      
      msgInput.value = "";
      cancelImageUpload();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
      if (!file.type.match('image.*')) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø·');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (5MB ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
      if (file.size > 5 * 1024 * 1024) {
        alert('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5MB');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        uploadedImage = e.target.result;
        document.getElementById("imagePreview").src = uploadedImage;
        document.getElementById("imagePreviewContainer").classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }

    // Ø¥Ù„ØºØ§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    function cancelImageUpload() {
      uploadedImage = null;
      document.getElementById("mediaUpload").value = "";
      document.getElementById("imagePreviewContainer").classList.add("hidden");
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø©
    function sendQuickMessage(msg) {
      document.getElementById("messageInput").value = msg;
      sendMessage();
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¶ØºØ· Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    function handleKeyDown(event) {
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    function updateChatUI() {
      chatBox.innerHTML = "";
      const messages = chatDB.getMessages();
      
      if (messages.length === 0) {
        chatBox.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-comment-dots text-4xl mb-2 text-indigo-400"></i>
            <p>Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
            <p class="text-sm mt-2 text-gray-400">Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ£Ø±Ø³Ù„ ØªØ­ÙŠØ© Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
          </div>
        `;
        return;
      }
      
      messages.forEach(msg => {
        const isCurrentUser = msg.userId === userId;
        const isSystem = msg.isSystem;
        
        const el = document.createElement("div");
        el.className = "mb-3 chat-bubble";
        
        if (isSystem) {
          el.innerHTML = `
            <div class="text-center text-gray-500 text-sm my-2">
              ${msg.text}
              <span class="message-time">${msg.time}</span>
            </div>
          `;
        } else {
          const adminBadge = msg.isAdmin ? '<span class="admin-badge">Ù…Ø¯ÙŠØ±</span>' : '';
          const guestBadge = msg.isGuest ? '<span class="guest-badge">Ø¶ÙŠÙ</span>' : '';
          
          el.innerHTML = `
            <div class="${isCurrentUser ? 'user-bubble' : ''}">
              <div class="flex ${isCurrentUser ? 'justify-end' : ''}">
                <div class="flex items-end ${isCurrentUser ? 'flex-row-reverse' : ''} mb-1">
                  <span class="font-bold text-sm ${isCurrentUser ? 'text-indigo-700' : 'text-gray-700'}">
                    ${adminBadge}${guestBadge}${msg.name}
                  </span>
                  <span class="message-time mx-2">${msg.time}</span>
                </div>
              </div>
              <div class="${isCurrentUser ? 'bg-indigo-100 border-indigo-200 text-right' : 'bg-gray-100 border-gray-200'} border rounded-2xl p-3 max-w-xs md:max-w-md inline-block">
                ${msg.text || ''}
                ${msg.image ? `
                  <div class="media-sent mt-2">
                    <img src="${msg.image}" class="image-preview cursor-pointer" onclick="openMediaModal('${msg.image}')">
                  </div>
                ` : ''}
                <div class="admin-controls mt-2">
                  <button onclick="deleteMessage('${msg.id}')" class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                  </button>
                </div>
              </div>
            </div>
          `;
        }
        
        chatBox.appendChild(el);
      });
      
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯
    function setupPresence() {
      // Ø£Ø¶Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø­Ø¶ÙˆØ±
      chatDB.addUser({
        id: userId,
        name: username,
        joined: formatTime(new Date()),
        isAdmin: isAdmin,
        isGuest: isGuest,
        lastSeen: Date.now()
      });
      
      updatePresenceUI();
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
      presenceInterval = setInterval(() => {
        chatDB.updateUser(userId);
        updatePresenceUI();
      }, 5000);
      
      window.addEventListener("beforeunload", () => {
        clearInterval(presenceInterval);
        chatDB.removeUser(userId);
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…ØºØ§Ø¯Ø±Ø©
        chatDB.addMessage({
          name: "Ø§Ù„Ù†Ø¸Ø§Ù…",
          text: `ØºØ§Ø¯Ø± ${username} ${isAdmin ? "(Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…)" : isGuest ? "(Ø¶ÙŠÙ)" : ""} Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©`,
          time: formatTime(new Date()),
          isSystem: true
        });
      });
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    function updatePresenceUI() {
      const now = Date.now();
      const users = chatDB.getUsers();
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ù„Ø£ÙƒØ«Ø± Ù…Ù† 15 Ø«Ø§Ù†ÙŠØ©
      const activeUsers = users.filter(user => now - user.lastSeen < 15000);
      activeUsers.forEach(user => chatDB.updateUser(user.id));
      
      const inactiveUsers = users.filter(user => now - user.lastSeen >= 15000);
      inactiveUsers.forEach(user => {
        chatDB.removeUser(user.id);
        chatDB.addMessage({
          name: "Ø§Ù„Ù†Ø¸Ø§Ù…",
          text: `Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ ${user.name} Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·`,
          time: formatTime(new Date()),
          isSystem: true
        });
      });
      
      const updatedUsers = chatDB.getUsers();
      const count = updatedUsers.length;
      usersCountEl.textContent = count;
      
      // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
      onlineUsersEl.innerHTML = '';
      
      if (updatedUsers.length === 0) {
        onlineUsersEl.innerHTML = '<div class="text-center text-gray-500 py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ØªØµÙ„ÙŠÙ†</div>';
        return;
      }
      
      updatedUsers.forEach(user => {
        const isCurrent = user.id === userId;
        const lastSeenDiff = now - user.lastSeen;
        const isActive = lastSeenDiff < 5000; // Ù†Ø´Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø° Ø£Ù‚Ù„ Ù…Ù† 5 Ø«ÙˆØ§Ù†
        const isIdle = lastSeenDiff >= 5000 && lastSeenDiff < 10000; // Ø®Ø§Ù…Ù„ Ø¥Ø°Ø§ Ø¨ÙŠÙ† 5-10 Ø«ÙˆØ§Ù†
        
        const userEl = document.createElement('div');
        userEl.className = `user-presence ${isCurrent ? 'bg-blue-50' : ''}`;
        
        const adminBadge = user.isAdmin ? '<span class="admin-badge">Ù…Ø¯ÙŠØ±</span>' : '';
        const guestBadge = user.isGuest ? '<span class="guest-badge">Ø¶ÙŠÙ</span>' : '';
        
        userEl.innerHTML = `
          <div class="presence-indicator ${isActive ? 'presence-online' : isIdle ? 'presence-idle' : 'presence-offline'}"></div>
          <div class="flex-1">
            <div class="font-medium">${adminBadge}${guestBadge}${user.name}</div>
            <div class="text-xs text-gray-500">Ù…ØªØµÙ„ Ù…Ù†Ø° ${user.joined}</div>
          </div>
          ${isCurrent ? '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Ø£Ù†Øª</span>' : ''}
        `;
        onlineUsersEl.appendChild(userEl);
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    function refreshPresence() {
      updatePresenceUI();
      showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ±
    function deleteMessage(messageId) {
      if (!isAdmin) return;
      if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) return;
      
      chatDB.deleteMessage(messageId);
      updateChatUI();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
    }
    
    function deleteAllMessages() {
      if (!isAdmin) return;
      if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) return;
      
      chatDB.clearMessages();
      updateChatUI();
      showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­');
    }
    
    function sendSystemMessage() {
      if (!isAdmin) return;
      const message = prompt("Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¹Ø§Ù…:");
      if (!message) return;
      
      chatDB.addMessage({
        name: "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        text: `ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù†: ${message}`,
        time: formatTime(new Date()),
        isSystem: true,
        isAdmin: true
      });
      updateChatUI();
      showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­');
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
    function listenToMessages() {
      updateChatUI();
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©
      setInterval(updateChatUI, 2000);
    }

    // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
    function goBack() {
      // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…ØºØ§Ø¯Ø±Ø©
      chatDB.addMessage({
        name: "Ø§Ù„Ù†Ø¸Ø§Ù…",
        text: `ØºØ§Ø¯Ø± ${username} ${isAdmin ? "(Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…)" : isGuest ? "(Ø¶ÙŠÙ)" : ""} Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©`,
        time: formatTime(new Date()),
        isSystem: true
      });
      
      // Ø­Ø°Ù Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      chatDB.removeUser(userId);
      clearInterval(presenceInterval);
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
      username = "";
      isAdmin = false;
      isGuest = false;
      adminPanel.classList.add("hidden");
      adminBadge.classList.add("hidden");
      guestBadge.classList.add("hidden");
      document.body.classList.remove("admin");
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
      document.getElementById("nameModal").style.display = "flex";
    }

    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
    function openMediaModal(mediaUrl = null) {
      const mediaModal = document.getElementById('mediaModal');
      const mediaList = document.getElementById('mediaList');
      
      mediaList.innerHTML = '';
      
      // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      const mediaItems = chatDB.getMedia();
      if (mediaItems.length === 0) {
        mediaList.innerHTML = '<p class="text-gray-500 col-span-4 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ³Ø§Ø¦Ø· Ù…Ø±Ø³Ù„Ø© Ø¨Ø¹Ø¯</p>';
      } else {
        mediaItems.forEach(media => {
          const mediaEl = document.createElement('div');
          mediaEl.className = 'bg-gray-100 rounded-lg overflow-hidden cursor-pointer';
          mediaEl.innerHTML = `
            <img src="${media.url}" class="w-full h-32 object-cover" onclick="showFullImage('${media.url}')">
            <div class="p-2">
              <div class="text-sm font-medium">${media.sender}</div>
              <div class="text-xs text-gray-500">${media.time}</div>
            </div>
          `;
          mediaList.appendChild(mediaEl);
        });
      }
      
      mediaModal.classList.remove('hidden');
      
      // Ø¥Ø°Ø§ ØªÙ… ØªÙ…Ø±ÙŠØ± Ø±Ø§Ø¨Ø· ÙˆØ³Ø§Ø¦Ø·ØŒ Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„
      if (mediaUrl) {
        showFullImage(mediaUrl);
      }
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„
    function showFullImage(imageUrl) {
      const mediaModal = document.getElementById('mediaModal');
      mediaModal.innerHTML = `
        <div class="bg-black bg-opacity-90 fixed inset-0 flex items-center justify-center">
          <button onclick="closeMediaModal()" class="absolute top-4 right-4 text-white text-2xl">
            <i class="fas fa-times"></i>
          </button>
          <img src="${imageUrl}" class="max-h-screen max-w-screen p-4">
        </div>
      `;
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
    function closeMediaModal() {
      document.getElementById('mediaModal').classList.add('hidden');
    }
    
    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-check-circle mr-2"></i>
          <span>${message}</span>
        </div>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      document.getElementById('nameModal').style.display = 'flex';
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
      updateDateTime();
      setInterval(updateDateTime, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
      
      // Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      document.getElementById('usernameInput').addEventListener('input', function() {
        if (this.value === 'Ø³Ø¬Ø§Ø¯') {
          adminMessage.classList.remove('hidden');
        } else {
          adminMessage.classList.add('hidden');
        }
      });
      
      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
      document.getElementById('mediaUpload').addEventListener('change', handleImageUpload);
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø£ÙˆÙ„ÙŠØ©
      generateRandomUsername();
      generateRandomPassword();
    });
  </script>
</body>
</html>
